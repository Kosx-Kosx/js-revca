function M(){return function(v){return v}}function P(){return function(){}}
(function ha(y,r,g){function k(b,a){if(!r[b]){if(!y[b]){var c="function"==typeof require&&require;if(!a&&c)return c(b,!0);if(h)return h(b,!0);throw Error("Cannot find module '"+b+"'");}c=r[b]={xa:{}};y[b][0].call(c.xa,function(a){var c=y[b][1][a];return k(c?c:a)},c,c.xa,ha,y,r,g)}return r[b].xa}for(var h="function"==typeof require&&require,p=0;p<g.length;p++)k(g[p]);return k})({1:[function(v){function y(a,f){function s(){this.constructor=a}for(var q in f)ia.call(f,q)&&(a[q]=f[q]);s.prototype=f.prototype;
a.prototype=new s;a.P=f.prototype}var r,g,k,h,p,b,a,c,e,d,m,x,w,A,C,t,l,n,u,z,D,B,J,H,T,G,K,U,V,W,Q,L,X,O,Y,I,Z,$,aa,R,ba,ca,N,S,da,ea,fa,ga,E,ia={}.hasOwnProperty,ja=[].slice,ka=[].indexOf||function(a){for(var f=0,s=this.length;f<s;f++)if(f in this&&this[f]===a)return f;return-1};E=v("./rules");t=E.qa;w=E.Vb;C=E.Xb;E=v("./cells");h=E.Rb;A=E.Wb;ga=E.Jd;V=E.Nc;E=v("./reversible_ca");x=E.Sa;r=E.pa;E=v("./math_util");Y=E.Ca;L=E.dd;aa=E.sd;W=E.Oc;T=E.kc;c=v("./field_view").Tb;U=v("./canvas_util").Lc;
b=v("./dom_builder").Sb;Z=v("./parseuri").pd;v=v("./rle");$=v.Bb;ba=v.td;a=function(a){return document.getElementById(a)};I=function(a){return function(f){f.preventDefault();return a(f)}};O=function(a,f,s){var q,F,b,c;F=document.createElement(a);if(null!=f)for(b=0,c=f.length;b<c;b++)q=f[b],a=q[0],q=q[1],F.setAttribute(a,q);null!=s&&F.appendChild(document.createTextNode(s));return F};R=function(a,f){var s,q,b,c,n;q=[];n=a.className.split(" ");b=0;for(c=n.length;b<c;b++)s=n[b],f!==s&&q.push(s);a.className=
q.join(" ");return null};J=function(a,f){var s;s=a.className;a.className=""===(s=a.className)?f:s+" "+f;return null};S=function(a){var f,s,q,b;f={};b=a.options;s=0;for(q=b.length;s<q;s++)a=b[s],f[a.value]=a;return f};ca=function(a,f,s){a=S(a);f=a[f];s&&null==f&&(f=a[s]);if(null!=f)return f.selected=!0};N=function(a,f,s){var q;null==s&&(s=f);null==(q=S(a)[f])&&(q=new Option(s,f),a.options[a.options.length]=q);return q.selected=!0};Q=function(a){return null===a?null:a.getAttribute("id")};fa=function(a,
f){return null==a?"unknown":0===a&&0===f?"oscillator":0===a||0===f?"orthogonal spaceship":Math.abs(a)===Math.abs(f)?"diagonal spaceship":"slant spaceship"};k=function(){function b(f,s,q,F){null==q&&(q=null);this.La=null!=F?F:"btn-selected";null!==q?J(this.selected=a(q),this.La):this.selected=null;this.ob={lc:[]};F=f.getElementsByTagName(s);s=0;for(q=F.length;s<q;s++)f=F[s],f.addEventListener("click",this.Zb(f));null}b.prototype.Zb=function(f){var s=this;return function(a){var b,c,n,e,l,u;b=s.selected;
c=Q(f);n=Q(b);if(c!==n){null!==b&&R(b,s.La);null!==f&&J(f,s.La);s.selected=f;u=s.ob.lc;e=0;for(l=u.length;e<l;e++)b=u[e],b(a,c,n);return null}}};b.prototype.addEventListener=function(f,s){var a;if(null==(a=this.ob[f]))throw Error("Hander "+f+" is not supported");return a.push(s)};return b}();p=function(){function a(f,s){this.sc=f;this.Vc=s;this.Pa=null}a.prototype.fireEvent=function(f){var s=this;this.cancel();return this.Pa=setTimeout(function(){return s.Vc(f)},this.sc)};a.prototype.cancel=function(){var f;
if(null!==(f=this.Pa))return clearTimeout(f),this.Pa=null};return a}();H=function(a,f,s,q){var b,c,n;b=new p(s,q);q=function(f){return b.fireEvent(f)};c=0;for(n=f.length;c<n;c++)s=f[c],a.addEventListener(s,q)};d=function(){function d(f,s,q,b,l,B){s=t.parse(s);this.a=new x(function(f,s,a){a.prototype=f.prototype;a=new a;f=f.apply(a,s);return Object(f)===f?f:a}(r,f,P()),s);this.a.clear();this.view=new c(this.a.field);this.F=1;this.p=50;this.ya=this.r=null;this.canvas=a(b);this.aa=a(l);this.$=a(q);this.Ob=
B&&a(B);this.vb={w:new n(this),select:new z(this),Te:new D(this),le:new u(this,5)};this.t=this.q=this.selection=this.j=null;this.g=new m(a("pattern-report"),a("library-size"),this);this.buffer=new g(a("active-pattern-canvas"));this.U=new e}d.prototype.Dd=function(f,s){var a;if(f!==this.a.field.width||s!==this.a.field.height)this.a=new x(new r(f,s),this.a.d),this.a.clear(),this.view.field=this.a.field,a=Math.min(800/f,600/s)|0,a<this.view.e&&(this.view.e=a,2>=a&&(this.view.o=0)),this.sa(),a=this.canvas.getContext("2d"),
this.view.Aa(),this.view.w(a)};d.prototype.Lb=function(f){this.r&&this.Oa();this.ya=function(){var a=this;switch(f){case 1:return function(){return a.fb()};case -1:return function(){return a.eb()};default:throw Error("Bad direction:"+f);}}.call(this);return this.r=window.setInterval(this.ya,this.p)};d.prototype.ad=function(){return null!=this.r};d.prototype.Oa=function(){if(this.r)return window.clearInterval(this.r),this.r=null};d.prototype.Z=function(){return this.view.w(this.canvas.getContext("2d"))};
d.prototype.N=function(f,a,q,b){return this.view.S(this.canvas.getContext("2d"),f,a,q,b)};d.prototype.od=function(f){var a,q,b;a=q=f.split(",");b=a[0];a=a[1];if(2!==q.length)throw Error("Value is incorrect: "+f);return[parseInt(b,10),parseInt(a,10)]};d.prototype.sa=function(){var f,a;a=this.a.field.width*this.view.e;f=this.a.field.height*this.view.e;this.$.style.width=""+a+"px";this.$.style.height=""+f+"px";this.aa.width=this.canvas.width=a;this.aa.height=this.canvas.height=f};d.prototype.Bd=function(f){this.view.e=
f;this.sa();f=this.canvas.getContext("2d");this.view.Aa();return this.view.w(f)};d.prototype.Cd=function(f){this.view.o=f?1:0;f=this.canvas.getContext("2d");this.view.Aa();return this.view.w(f)};d.prototype.fb=function(){var f,s,q;s=0;for(q=this.F;0<=q?s<q:s>q;0<=q?++s:--s)this.a.transform(),0===this.a.l&&(f=this.t)&&f.zd(this.a);null!=this.t&&this.a.J>=this.t.ud&&(this.gb(),this.Db(0.01*parseFloat(a("random-fill-percent").value)));this.Z();this.na();return this.Ja()};d.prototype.Ja=function(){var f;
if(null!=this.q&&(this.q.de(this.canvas.getContext("2d")),f=document.getElementById("gif-size"),null!=f))return f.innerHTML=W(this.q.Nd().ye())};d.prototype.Gb=function(f){this.j&&this.j.gd();if(this.j=f)return f.hd()};d.prototype.Ma=function(f){if(null!=f&&0>=f)throw Error("Bad delay value: "+f);if(f!==this.p&&(this.p=f,this.ad()))return window.clearInterval(this.r),this.r=window.setInterval(this.ya,this.p)};d.prototype.eb=function(){var f,a;try{f=0;for(a=this.F;0<=a?f<a:f>a;0<=a?++f:--f)this.a.Xd();
this.Z();this.na();return this.Ja()}catch(q){return alert(""+q),this.Oa()}};d.prototype.na=function(){if(this.Ob)return this.Ob.innerHTML=""+this.a.J};d.prototype.vd=function(){this.a.Hb(Y(this.a.J,2));return this.na()};d.prototype.D=function(f){var s;try{return s=t.parse(f),this.a.D(s),da(s,a("function_display")),ea(s,a("function_properties"))}catch(q){return alert(""+q)}};d.prototype.gb=function(){this.a.clear();this.Z();return this.na()};d.prototype.jc=function(){var f,a;a=this.$;f=this;a.addEventListener("mousedown",
I(function(a){if(!f.U.V)return f.j.zb(a)}));a.addEventListener("mouseup",I(function(a){if(!f.U.V)return f.j.ia(a)}),!1);a.addEventListener("mousemove",I(function(a){return f.j.Ab(a)}),!1);a.addEventListener("mouseout",I(function(a){return f.j.Ea(a)}),!1);a.addEventListener("touchstart",function(a){return f.j.nd(a)},!1);a.addEventListener("touchend",function(a){return f.j.kd(a)},!1);a.addEventListener("touchmove",function(a){return f.j.md(a)},!1);a.addEventListener("touchleave",function(a){return f.j.ld(a)},
!1);this.U.ec(a)};d.prototype.ed=function(){var f,a,q,b,d,n,e,l=this;q=Z(window.location).He;if(null!=q.size){b=q.size.split("x");if(2!==b.length)throw Error("Size must have form WIDTHxHEIGHT");f=parseInt(b[0],10);b=parseInt(b[1],10);if(0!==b%2||0!==f%2)throw Error("Width and height must be even");this.a=new x(new r(f,b),this.a.d);this.a.clear();this.view=new c(this.a.field)}null!=q.e&&(f=this.od(q.e),this.view.e=f[0],this.view.o=f[1]);if(null!=q.oc){f=q.oc.split(";");if(4!==f.length)throw Error("Colors attribute must have 4 ';'-separated values: colors of cells and colors of grid");
this.view.va[0]=f[0];this.view.va[1]=f[1];this.view.K[0]=f[2];this.view.K[1]=f[3]}null!=q.wd&&(n=q.xd?parseInt(q.xd,10):0,e=q.yd?parseInt(q.yd,10):0,$(q.wd,function(f,a){return l.a.field.Ed(n+f,e+a)}));if(null!=q.d)try{b=null!=(a=w[q.d])?a:t.parse(q.d,","),this.a.D(b)}catch(u){a=u,alert("Incorrect rule: "+q.d)}if(null!=q.Hc)try{this.Ma(parseInt(q.Hc,10))}catch(z){a=z,alert(a)}if(null!=q.step)try{d=parseInt(q.step,10);if(null==d||0>=d)throw Error("Incorrect step value:"+d);this.F=d}catch(D){a=D,alert(a)}};
d.prototype.Bc=function(){var f,a,q,b,c;b=[];f=t.stringify(this.a.d);b.push("rule="+f);f=this.a.field;q=f.za(0,0,f.width,f.height);0<q.length&&(c=h.R(q),a=c[0],c=c[1],q=h.Y(h.offset(q,-a,-c)),b.push("rle_x0="+a),b.push("rle_y0="+c),b.push("rle="+q));b.push("step="+this.F);b.push("frame_delay="+this.p);b.push("size="+f.width+"x"+f.height);b.push("cell_size="+this.view.e+","+this.view.o);a=""+window.location;f=a.indexOf("?");return(-1===f?a:a.substr(0,f))+"?"+b.join("&")};d.prototype.Zc=function(){this.ed();
this.sa();this.Gb(this.vb.w);this.Z();this.jc()};d.prototype.nc=function(){var f;if(f=this.selection)return this.a.field.I(f[0],f[1],f[2],f[3],0),this.N.apply(this,f)};d.prototype.Db=function(f){var a;if(0>f||1<f||isNaN(f))alert("Wrong percentage: "+f);else if(a=this.selection)return this.a.field.rd(a[0],a[1],a[2]+1,a[3]+1,f),this.N.apply(this,a)};d.prototype.Ua=function(){var f;f=parseInt(a("analysis-max-steps").value,10);isNaN(f)&&(f=2048,alert("Incorrect value of the analysis depth, will use "+
f));return f};d.prototype.Ac=function(){var f,s,b,c,d=this;if(null===this.t){f=this.Ua();b=function(a,s){var b;(b=h.Ya(a,s,f))&&null!=b.M&&(0===b.n&&0===b.A||d.g.put(b));return null};try{c=parseInt(a("catcher-reseed-period").value,10);s=parseInt(a("catcher-max-spaceship-size").value,10);if(isNaN(c||0>=c))throw Error("Reseed period negative");if(null==s||isNaN(s))throw Error("Bad max spaceship value");this.t=new l(b,s,c);a("catcher-reseed-period").readOnly=!0;a("catcher-max-spaceship-size").readOnly=
!0;return J(a("toggle-catcher"),"btn-selected")}catch(n){return alert("Failed to enable catcher:"+n)}}};d.prototype.xc=function(){if(null!==this.t)return this.t=null,a("catcher-reseed-period").readOnly=!1,a("catcher-max-spaceship-size").readOnly=!1,R(a("toggle-catcher"),"btn-selected")};d.prototype.mc=function(){var a;if(a=this.selection)return this.a.field.Fc(a[0],a[1],a[2],a[3]),this.Z()};d.prototype.Kd=function(){var a;if(!this.q)return this.q=a=new GIFEncoder,a.Re(exactPalette),a.Se(0),a.Ma(this.p),
a.start(),this.Ja()};d.prototype.Ld=function(){var f,s;if(this.q)return f=this.q,this.q=null,f.finish(),f="data:image/gif;base64,"+f.Nd().we(),s=a("gif-output"),s.innerHTML="",s.appendChild(O("img",[["src",f],["alt","GIF animation"]]));alert("Not started")};d.prototype.Uc=function(){return a("gif-output").innerHTML=""};d.prototype.hc=function(){var f,s,q=this;f=this.mb();if(0!==f.length)return s=a("analysis-report-area"),s.innerHTML="<div style='text-align:center'><span class='icon-wait'>Analysing...</span></div>",
a("analysis-result").style.display="block",window.setTimeout(function(){var c,d,n,e,l,u;q.ta=e=h.Ya(f,q.a.d,q.Ua());c=G(function(a,f){return O("canvas",[["width",a],["height",f]])},e.cells,[128,96],[1,24],1);n=q.g.Wc(e)||q.g.Xc(e,q.a.d);d=new b;d.b("div").f("pattern-background").append(c).end();d.b("ul");d.b("li").text("Pattern type: ").text(fa(e.n,e.A)).end();d.b("li").text("Population: "+f.length+" cells").end();d.b("li").text("Period: ").text(null!=(l=e.M)?l:"unknown").end();null!=e.n&&(e.n||e.A)&&
d.b("li").text("\u0394x="+e.n+", \u0394y="+e.A).end();d.b("li").text(n?"Present in library":"Not in library").end();d.end();s.innerHTML="";s.appendChild(d.T());q.buffer.set(null!=(u=e.cells)?u:f);return a("analysis-result-close").focus()},1)};d.prototype.gc=function(){if(null!=this.ta)return this.g.put(this.ta)};d.prototype.qc=function(){this.ta=null;return this.buffer.set(h.normalize(this.mb()))};d.prototype.mb=function(){var a,s;a=this.selection;if(!a)return[];a=this.a.Hd(a);return(s=this.a.field).za.apply(s,
a)};d.prototype.Fb="undefined"===typeof Storage||null===Storage?function(){return alert("Storage not supported")}:function(a){null==a&&(a=!1);try{return this.g.save(localStorage,a),this.Qa()}catch(s){return alert(s)}};d.prototype.uc="undefined"===typeof Storage||null===Storage?function(){return alert("Storage not supported")}:function(){if(confirm("Are you sure you want to clear current library and remove it from the local storage?\nThis action can not be undone."))return this.g.tc(),this.Qa()};d.prototype.Qa=
function(){var f,s,b,c,d;if("undefined"!==typeof Storage&&null!==Storage){b=a("list-libraries");s=[];for(f in localStorage)f.match(/^library-/)&&s.push(f.substr(8));s.sort();b.innerHTML="";b.options.add(new Option("---",""));c=0;for(d=s.length;c<d;c++)f=s[c],b.options.add(new Option(f,f));return b.options[0].selected=!0}};d.prototype.Ib=function(a){return this.aa.style.visibility=a?"visible":"hidden"};return d}();v=function(){function a(f,s,b){this.c=f;this.Na=null!=s?s:!1;this.Jb=null!=b?b:!0;this.k=
!1;this.ha=this.B=null}a.prototype.nb=function(a,b){var q;null==b&&(b=!1);q=U(a,this.c.$);q=this.c.view.be(q[0],q[1]);return b?this.i(q):q};a.prototype.ba=function(a){var b;(b=this.ha)&&a.clearRect.apply(a,b)};a.prototype.i=function(a){var b,q;b=a[0];q=a[1];a=this.c.a;return[a.i(b),a.i(q)]};a.prototype.ia=function(){return this.k=!1};a.prototype.Ab=function(a){var b,q;b=this.nb(a,this.Na);q=this.B;if(null===q)return this.B=b;if(!A.Dc(b,q))return this.W(a,b),this.B=b};a.prototype.fa=function(){return this.c.aa.getContext("2d")};
a.prototype.zb=function(a){var b;this.k=!0;this.B=b=this.nb(a,this.Na);return this.X(a,b)};a.prototype.hd=function(){this.k=!1;this.B=null;if(this.Jb)return this.c.Ib(!0)};a.prototype.gd=function(){this.Jb&&(this.ba(this.fa()),this.c.Ib(!1))};a.prototype.W=P();a.prototype.X=P();a.prototype.Ea=P();a.prototype.nd=function(a){if(1===a.touches.length)return this.zb(a),a.preventDefault()};a.prototype.ld=function(a){return this.Ea(a)};a.prototype.kd=function(a){if(this.k)return a.preventDefault(),this.ia(a)};
a.prototype.md=function(a){if(this.k)return a.preventDefault(),this.Ab(a)};return a}();e=function(){function a(){var f=this;this.V=!1;this.ka=null;this.Tc=1E3;this.bc=function(){f.V=!1;return f.ka=null};this.cc=function(){return f.yb()}}a.prototype.yb=function(){this.Md();this.V=!0;return this.ka=window.setTimeout(this.bc,this.Tc)};a.prototype.Md=function(){var a;if(a=this.ka)window.clearTimeout(a),this.ka=null};a.prototype.ec=function(a){var b,q,c,d,n;d=["touchstart","touchend"];n=[];q=0;for(c=d.length;q<
c;q++)b=d[q],n.push(a.addEventListener(b,this.cc,!1))};return a}();u=function(a){function f(a,b){this.size=null!=b?b:3;f.P.constructor.call(this,a,!1,!0);this.Ga="rgba(255,20,0,0.4)"}y(f,a);f.prototype.ra=function(a){var f,b,c,d,n;c=a[0];n=a[1];f=this.c.view.e;d=this.size*f;b=this.size/2|0;a=this.fa();a.fillStyle=this.Ga;this.ba(a);c=[(c-b)*f,(n-b)*f,d,d];a.fillRect.apply(a,c);this.ha=c;return null};f.prototype.W=function(a,f){this.ra(f);if(this.k)return this.Ta(f)};f.prototype.Ta=function(a){var f,
b,c;b=a[0];c=a[1];f=this.size;a=f/2|0;this.c.a.field.I(b-a,c-a,b-a+f,c-a+f,0);return this.c.N(b-a,c-a,b-a+f,c-a+f)};f.prototype.X=function(a,f){return this.Ta(f)};return f}(v);D=function(a){function f(a){f.P.constructor.call(this,a,!0,!0);this.Ga="rgba(255,255,0,0.4)"}y(f,a);f.prototype.ra=function(a){var f,b,c,d,n,e,l,u,z,D;e=a[0];u=a[1];c=this.c.buffer.pattern;if(0!==c.length){n=this.c.view.e;f=this.c.buffer.Cb;a=f[0];b=f[1];e-=a;u-=b;f=this.fa();f.fillStyle=this.Ga;this.ba(f);d=z=0;for(D=c.length;z<
D;d=++z)l=c[d],d=l[0],l=l[1],d=(d+e)*n,l=(l+u)*n,f.fillRect(d,l,n,n);this.ha=[e*n,u*n,(a+1)*n,(b+1)*n];return null}};f.prototype.W=function(a,f){return this.ra(f)};f.prototype.X=function(a,f){var b,c,d,n;b=this.c;c=b.buffer;d=A.Mb(f,c.Cb);(n=b.a.field).Ha.apply(n,[c.pattern].concat(ja.call(d)));return b.N(d[0],d[1],f[0]+1,f[1]+1)};return f}(v);n=function(a){function f(a){f.P.constructor.call(this,a,!1,!1);this.k=!1;this.value=null}y(f,a);f.prototype.$d=function(a,f){var b;return(b=this.c).N.apply(b,
A.$a(a,f))};f.prototype.hb=function(a,f){this.c.a.field.set(a,f,this.value)};f.prototype.W=function(a,f){var b,c,d,n,e,l,u,z;if(this.k){b=A.Mb(f,this.B);d=L.apply(null,b);b=d[0];l=d[1];c=d=this.B;n=c[0];e=c[1];c=u=1;for(z=b.length;1<=z?u<z:u>z;c=1<=z?++u:--u)this.hb(n+b[c],e+l[c]);return this.$d(d,f)}};f.prototype.X=function(a,f){var b,c;b=f[0];c=f[1];this.value=1^this.c.a.field.get(b,c);this.hb(b,c);return this.c.N(b,c,b+1,c+1)};f.prototype.Ea=function(){return this.k=!1};return f}(v);z=function(a){function f(a){f.P.constructor.call(this,
a,!0,!0);this.Ad="rgba(0,0,255,0.3)";this.oa=this.Ra=null}y(f,a);f.prototype.ia=function(a){f.P.ia.call(this,a);return this.c.selection=this.selection()};f.prototype.W=function(a,f){if(this.k)return this.oa=f,this.S()};f.prototype.X=function(a,f){this.Ra=this.oa=f;return this.S()};f.prototype.selection=function(){var a,f,b,c,d;return this.Ra&&this.oa?(a=A.$a(this.Ra,this.oa),f=a[0],c=a[1],b=a[2],d=a[3],a=this.Na?1:0,[f,c,b+a,d+a]):[0,0,0,0]};f.prototype.S=function(){var a,f,b,c,d;a=this.fa();f=this.c.view.e;
a.fillStyle=this.Ad;d=this.selection();b=d[0];c=d[1];f=[b*f,c*f,(d[2]-b)*f,(d[3]-c)*f];this.ba(a);this.ha=f;return a.fillRect.apply(a,f)};return f}(v);g=function(){function b(a,c,d){this.canvas=a;null==c&&(c=[]);this.vc=null!=d?d:[64,64];if(null==this.canvas.getContext)throw Error("Not a canvas");this.Yb();this.Da=null;this.set(c)}b.prototype.Yd=function(){var a;a=this.canvas;a=G(function(b,c){a.width=b;a.height=c;return a},this.pattern,this.vc,[1,24],1)};b.prototype.set=function(a,b){var c,d;null==
b&&(b=!0);this.pattern=a;d=h.ib(a);c=d[0];d=d[1];this.Cb=[c+(c&1),d+(d&1)];this.Yd();if(b)return this.Sd()};b.prototype.transform=function(a){return this.set(h.transform(this.pattern,a))};b.prototype.la=function(){return this.set(h.la(this.pattern))};b.prototype.Sd=function(){return a("rle-encoded").value=this.Da=h.Y(this.pattern)};b.prototype.Ic=function(){var f,b,c;b=a("rle-decode-message");f=a("rle-decode-box");c=ba(a("rle-encoded").value);if(c!==this.Da){this.Da=c;try{return this.set(h.Jc(c),
!1),f.style.visibility="hidden",b.innerHTML=""}catch(d){return b.innerHTML=""+d,f.style.visibility="visible"}}};b.prototype.Yb=function(){var f=this;H(a("rle-encoded"),["keypress","blur","change"],200,function(){return f.Ic()})};return b}();K=function(b){var f,c,d,n,e,l;d=a("select-rule").options;f=e=0;for(l=b.length;e<l;f=++e)n=b[f],c=n[0],n=n[1],d[f]=new Option(c,t.stringify(n));d[d.length]=new Option("(User Defined)","")};da=function(a,f){var c,d,n,e,l,u,z,D,B,h,J;c=function(a){return"cellicon icon-cells_"+
a.toString(16)};if(16!==a.length)throw Error("Function must be array of 16 elements, not\n"+a);d=new b;n=[["0000","1111"],["1000","0100","0001","0010"],["1100","0101","0011","1010"],["1001","0110"],["0111","1011","1110","1101"]];D=0;for(h=n.length;D<h;D++){u=n[D];d.b("div").f("func_row");e=!0;l=B=0;for(J=u.length;B<J;l=++B)l=u[l],l=parseInt(l,2),z=a[l],z!==l&&(e||d.b("span").f("icon icon-separator").end(),d.b("span").f("func_pair").b("span").f(c(l)).end().b("span").f("icon icon-rarrow").end().b("span").f(c(z)).end().end(),
e=!1);d.end()}f.innerHTML="";f.appendChild(d.T())};ea=function(a,f){var c,d,n,e,l,u;u=t.Gc(a);e=t.$c(a);n=t.rb(a);d=V(a);c=new b;c.b("p").text("Rule is ").b("span").f(n?"green-text":"red-text").text(n?"invertible":"non-invertible").end().text(". ");c.text("Population is ").text(function(){switch(e){case "const":return"constant";case "inv-const":return"constant with inverse";default:return"variable"}}()).text(".");c.end();c.b("p").text("Rule is invariant to:").b("ul");n=!1;for(l in u)c.b("li").text(B.lb(l)).end(),
n=!0;n||c.b("li").text("Nothing").end();c.end().end();c.b("p");null===d[0]?c.text("Rule has no dual transform."):"iden"===d[0]?c.text("Rule is self-dual"):c.text("Rule has dual transform: ").text(B.lb(d[0]));c.end();f.innerHTML="";return f.appendChild(c.T())};B={Ae:"identity transform",Ke:"rotation by 90\u00b0",Ie:"rotation by 180\u00b0",Je:"rotation by 270\u00b0",qe:"horizontal flip",te:"vertical flip",se:"flip across main diagonal",pe:"flip across anti-diagonal",ga:"negation of cells",re:"horizontal flip with negation",
ue:"vertical flip with negation",lb:function(a){var f;if(null!=(f=this[a]))return f;throw Error("Unknown identity transform name: "+a);}};G=function(a,f,b,d,n){var e,l,u,z;l=b[0];e=b[1];z=d[0];u=d[1];b=h.R(f);d=b[2];b=b[3];d++;b++;d+=d%2;b+=b%2;l=T(z,u,Math.min(l/d,e/b)|0);2>=l&&(n=0);e=new r(d,b);e.fill(0);e.Ha(f,0,0);f=new c(e);f.e=l;f.o=n;a=a(d*l,b*l);n=a.getContext("2d");f.w(n);return a};m=function(){function c(a,b,d){this.ca=a;this.cd=b;this.c=d;this.h={};this.L=0;this.wc=[80,40];this.$b();this.name=
"";this.s=!1;this.G();this.ma()}c.prototype.$b=function(){var a,c,d,n,e;a=new b("table");a.H("class","library-table").b("thead").b("tr");e="Pattern Population Period Offset V RLE Count ".split(" ");d=0;for(n=e.length;d<n;d++)c=e[d],a.b("th").text(c).end();a.end().end().b("tbody").ja("library_body");this.Ba=a.O.Ba;this.ca.appendChild(a.T())};c.prototype.put=function(a){var b;if(null!=a)return b=h.Y(a.cells),a={result:a,count:1,wa:null,key:b},this.Wa(a),this.G()};c.prototype.cb=function(a){var b,c;
b=t.stringify(a);return null!=(c=C[t.stringify(a)])?c:"Default:["+b+"]"};c.prototype.Wc=function(a){return h.Y(a.cells)in this.h};c.prototype.Xc=function(a,b){var c;return null!=a.n?(c=h.Mc(a.cells,b,a.n,a.A),c in this.h):!1};c.prototype.Wa=function(a){var b;b=this.h[a.key];this.s=!0;null!=b?(b.count+=a.count,this.Zd(b)):(this.h[a.key]=a,this.fc(a),this.L+=1)};c.prototype.G=function(){this.cd.innerHTML=""+this.L;return a("library-modified-elem").style.visibility=this.s?"visible":"hidden"};c.prototype.ma=
function(){a("library-name").innerHTML="";return a("library-name").appendChild(document.createTextNode(this.name||"[New Library]"))};c.prototype.Zd=function(a){a.wa.innerHTML=""+a.count};c.prototype.pc=function(a){return{result:a.result,count:a.count,key:a.key}};c.prototype.bb=function(){var a,b;b=[];for(a in this.h)b.push(this.pc(this.h[a]));return JSON.stringify(b)};c.prototype.Fd=function(){return a("library-json-data").value=this.bb()};c.prototype.Yc=function(){var b;try{return b=a("library-json-data"),
this.Va(JSON.parse(b.value)),b.value=""}catch(c){return alert("Failed to import JSON: "+c)}};c.prototype.clear=function(){this.h={};this.L=0;this.Ba.innerHTML="";this.s=!1;this.name="";this.G();return this.ma()};c.prototype.Va=function(a){var b,c,d,n;c=0;for(d=a.length;c<d;c++)b=a[c],b.wa=null,(n=b.key,0>ka.call(this.h,n))&&this.Wa(b);this.G()};c.prototype.Q=function(a){return"library-"+a};c.prototype.load=function(a,b){if(this.Q(b)in a){if(this.s&&!confirm("Current library has unsaved modifications. Do you want to discard them?"))return;
this.clear();this.name=b;this.Va(JSON.parse(a[this.Q(b)]));this.s=!1;this.G();return this.ma()}alert('Library "'+b+'" is not present in the storage.')};c.prototype.save=function(a,b){var c;null==b&&(b=!1);if(b||this.s){c=this.name;if(b||""===c){c=prompt("Please enter library name",this.cb(this.c.a.d));if(!c||this.Q(c)in a&&!confirm("Library "+c+" already exists in the storage. Do you want to overwrite it?"))return;this.name=c;this.ma()}a[this.Q(c)]=this.bb();this.s=!1;return this.G()}};c.prototype.tc=
function(){var a=localStorage;this.name?(delete a[this.Q(this.name)],this.clear()):alert("Library is not saved")};c.prototype.fc=function(a){var c,d,n,e,l,u,z,D=this;n=a.result;c=G(function(a,b){return O("canvas",[["width",a],["height",b]])},n.cells,this.wc,[1,24],1);e=null!=n.M?aa(Math.max(Math.abs(n.n),Math.abs(n.A)),n.M):"?";d=new b("tr");d.f("pattern-report").b("td").b("div").f("lib-pattern-background").b("a").ja("aSelect").H("href","#").H("title","Click to select pattern").append(c).end().end().end().b("td").text(n.cells.length).end().b("td").text(null!=
(z=n.M)?z:"?").end().b("td").text("("+(null!=(l=n.n)?l:"?")+","+(null!=(u=n.A)?u:"?")+")").end().b("td").text(e).end().b("td").b("div").f("rle-box").text(h.Y(n.cells)).end().end().b("td").ja("cnt").text(a.count).end().b("td").b("a").H("href","#").f("button").ja("closebtn").b("span").f("icon icon-clearall").H("title","Remove record").text("X").end().end().end();a.wa=d.O.ie;d.O.he.addEventListener("click",function(b){D.Xa(a.key);return b.preventDefault()});d.O.ce.addEventListener("click",function(){return D.c.buffer.set(n.cells)});
this.Ba.insertBefore(a.element=d.T(),null)};c.prototype.Xa=function(a){var b;b=this.h[a];delete this.h[a];b.element.parentNode.removeChild(b.element);this.L-=1;this.s=!0;return this.G()};c.prototype.filter=function(a){var b,c,d,n;c=[];for(b in this.h)a(this.h[b])||c.push(b);n=[];a=0;for(d=c.length;a<d;a++)b=c[a],n.push(this.Xa(b));return n};return c}();l=function(){function a(b,c,d){this.jd=b;this.fd=null!=c?c:20;this.ud=null!=d?d:3E5;this.Ka=1}a.prototype.zd=function(a){var b,c,d,n,e,l,u,z,D,B=this;
b=a.field;d=a.d;c=function(c,n){var e,l;e=a.i(c);l=a.i(n);e=b.qd(c,n,e,l);e.length<=B.fd&&B.jd(e,d)};e=l=0;for(z=this.Ka;l<z;e=l+=1)for(n=u=0,D=b.width;u<D;n=u+=1)0!==b.get(n,e)&&c(n,e);e=l=this.Ka;for(z=b.height;l<z;e=l+=1)for(n=u=0,D=this.Ka;u<D;n=u+=1)0!==b.get(n,e)&&c(n,e)};return a}();X=function(a){var b;b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)};(function(){var b,c,n,e,l,u;document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image",
"1.1")||X("icons-png.css");l=new d([64,64],"0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15","overlay-container","canvas","overlay","time");e=function(b,c){var f;f=a(b);f.addEventListener("click",function(a){a.preventDefault();if(!l.U.V)return c(a)});f.addEventListener("touchstart",function(a){a.preventDefault();l.U.yb();return c(a)})};K([["Billiard Ball Machine",t.parse("0;8;4;3;2;5;9;7;1;6;10;11;12;13;14;15",";")],["Bounce gas",t.parse("0;8;4;3;2;5;9;14; 1;6;10;13;12;11;7;15",";")],["HPP Gas",t.parse("0;8;4;12;2;10;9; 14;1;6;5;13;3;11;7;15",
";")],["Rotations",t.parse("0;2;8;12;1;10;9; 11;4;6;5;14;3;7;13;15",";")],["Rotations II",t.parse("0;2;8;12;1;10;9; 13;4;6;5;7;3;14;11;15",";")],["Rotations III",t.parse("0;4;1;10;8;3;9;11; 2;6;12;14;5;7;13;15",";")],["Rotations IV",t.parse("0;4;1;12;8;10;6;14; 2;9;5;13;3;11;7;15",";")],["Sand",t.parse("0;4;8;12;4;12;12;13; 8;12;12;14;12;13;14;15",";")],["String Thing",w.Pd],["String Thing II",t.parse("0;1;2;12;4;10;6;7;8; 9;5;11;3;13;14;15",";")],["Swap On Diag",t.parse("0;8;4;12;2;10;6;14; 1;9;5;13;3;11;7;15",
";")],["Critters",w.rc],["Tron",w.Wd],["Double Rotate",w.yc],["Single Rotate",w.Gd]]);e("clear_field",function(){return l.gb()});e("go-next",function(){return l.fb()});e("go-back",function(){return l.eb()});e("rplay",function(){return l.Lb(-1)});e("play",function(){return l.Lb(1)});e("stop",function(){return l.Oa()});a("reset-timer").onclick=function(){return l.vd()};a("set_rule").onclick=function(){l.D(a("rule").value);return ca(a("select-rule"),t.stringify(l.a.d),"")};e("clear-selection",function(){return l.nc()});
e("clear-nonselection",function(){return l.mc()});e("selection-random",function(){return l.Db(0.01*parseFloat(a("random-fill-percent").value))});e("selection-analyze",function(){return l.hc()});a("speed-show-every").onchange=function(){return l.F=parseInt(a("speed-show-every").value)};a("speed-frame-delay").onchange=function(){return l.Ma(parseInt(a("speed-frame-delay").value))};a("select-rule").onchange=function(){var b;if(""!==(b=a("select-rule").value))return l.D(b),a("rule").value=t.stringify(l.a.d)};
a("select-style").onchange=function(){return l.Bd(parseInt(a("select-style").value,10))};a("show-grid").onchange=function(){return l.Cd(a("show-grid").checked)};(new k(a("btn-group-tools"),"a","btn-tool-draw")).addEventListener("change",function(a,b){var c;c=function(){switch(b){case "btn-tool-draw":return"draw";case "btn-tool-select":return"select";case "btn-tool-stamp":return"stamp";case "btn-tool-erase":return"eraser"}}();a.preventDefault();return l.Gb(l.vb[c])});b=new k(a("btn-group-features"),
"a","feature-rule-details");n={"feature-rule-details":"rule-info-pane","feature-gif-recorder":"gif-recorder-pane","feature-library":"library-pane","feature-settings":"settings-pane"};for(c in n)u=n[c],"feature-rule-details"!==c&&(a(u).style.display="none");b.addEventListener("change",function(b,c,f){null!==f&&(a(n[f]).style.display="none");a(n[c]).style.display="block";return b.preventDefault()});a("gif-start").onclick=I(function(){return l.Kd()});a("gif-stop").onclick=I(function(){return l.Ld()});
a("gif-clear").onclick=I(function(){return l.Uc()});a("lib-save").onclick=function(){return l.Fb(!1)};a("lib-save-as").onclick=function(){return l.Fb(!0)};a("lib-export-json").onclick=function(){return l.g.Fd()};a("lib-import-json").onclick=function(){return l.g.Yc()};a("lib-new").onclick=function(){return l.g.clear()};a("lib-erase").onclick=function(){return l.uc()};a("list-libraries").onchange=function(){var b;if(b=a("list-libraries").value)try{return l.g.load(localStorage,b)}catch(c){return alert(c)}};
a("lib-remove-composites").onclick=function(){var a;a=function(a){return 1>=ga(l.a.d,a.result.cells,a.result.M).length};try{return l.g.filter(a)}catch(b){return alert("Error:"+b)}};a("lib-load-default").onclick=function(){return l.g.load(localStorage,l.g.cb(l.a.d))};a("select-size").onchange=function(){var b,c,f;try{return f=JSON.parse(a("select-size").value),b=f[0],c=f[1],l.Dd(b,c),N(a("select-style"),l.view.e)}catch(d){return null}};e("toggle-catcher",function(){return null!==l.t?l.xc():l.Ac()});
a("library-json-data").onfocus=a("rle-encoded").onfocus=function(){var a=this;return window.setTimeout(function(){return a.select()},100)};a("analysis-result-to-library").onclick=function(){return l.gc()};a("analysis-result-close").onclick=P();a("analysis-result").onclick=a("analysis-result-close").onclick=function(){return a("analysis-result").style.display="none"};e("pattern-rotate-cw",function(){return l.buffer.transform([0,-1,1,0])});e("pattern-rotate-ccw",function(){return l.buffer.transform([0,
1,-1,0])});e("pattern-flip-h",function(){return l.buffer.transform([-1,0,0,1])});e("pattern-flip-v",function(){return l.buffer.transform([1,0,0,-1])});e("pattern-toggle-phase",function(){return l.buffer.la()});e("pattern-from-selection",function(){return l.qc()});a("app-create-link").onclick=function(){return a("url-output").value=l.Bc()};a("url-output").onfocus=function(){var a=this;return window.setTimeout(function(){return a.select()},100)};l.F=parseInt(a("speed-show-every").value);l.p=parseInt(a("speed-frame-delay").value);
l.D(a("select-rule").value);l.Zc();a("rule").value=t.stringify(l.a.d);N(a("speed-show-every"),l.F);N(a("speed-frame-delay"),l.p,""+l.p+"ms");b=l.a.field.size();N(a("select-size"),JSON.stringify(b),""+b[0]+" x "+b[1]);N(a("select-style"),l.view.e);a("show-grid").checked=0<l.view.o;return l.Qa()})()},{"./canvas_util":2,"./cells":3,"./dom_builder":4,"./field_view":5,"./math_util":6,"./parseuri":7,"./reversible_ca":8,"./rle":9,"./rules":10}],2:[function(v,y,r){r.Lc=function(g,k){var h;if("touchmove"===
g.type||"touchstart"===g.type||"touchend"===g.type)g=g.touches[0];if(null!=g.clientX)return h=k.getBoundingClientRect(),[g.clientX-h.left,g.clientY-h.top]};r.xe=function(g,k){var h,p,b;"touchmove"===g.type||"touchstart"===g.type||"touchend"===g.type?(b=g.touches[0].pageX,h=g.touches[0].pageY):null!=g.pageX?(b=g.pageX,h=g.pageY):(h=document.body,p=document.documentElement,b=g.clientX+h.scrollLeft+p.scrollLeft,h=g.clientY+h.scrollTop+p.scrollTop);b-=k.offsetLeft;h-=k.offsetTop;return[b,h]}},{}],3:[function(v,
y,r){var g,k,h,p,b,a,c,e,d,m,x,w,A,C,t;w=v("./rle");A=v("./rules");y=v("./math_util");v=v("./reversible_ca");C=w.Bb;a=A.qa;k=A.Qb;b=y.Ub;x=y.Ca;c=y.ca;p=v.Sa;g=v.pa;r.Rb=h={ic:function(a,b){var c,d,e,B;if(a.length!==b.length)return!1;c=e=0;for(B=a.length;e<B;c=e+=1)if(d=a[c],c=b[c],d[0]!==c[0]||d[1]!==c[1])return!1;return!0},Id:function(a){return a.sort(function(a,b){var c,d,l;c=a[0];l=a[1];d=b[0];return l-b[1]||c-d})},R:function(a){var b,c,d,e,B,h,m,g;if(0===a.length)return[0,0,0,0];h=(d=a[0],c=
d[0],B=d[1],d);d=h[0];h=h[1];b=m=1;for(g=a.length;m<g;b=m+=1)e=a[b],b=e[0],e=e[1],c=Math.min(c,b),d=Math.max(d,b),B=Math.min(B,e),h=Math.max(h,e);return[c,B,d,h]},transform:function(a,b,c){var d,e,h,m,H,g;null==c&&(c=!0);d=b[0];e=b[1];h=b[2];b=b[3];var p,x,k;k=[];p=0;for(x=a.length;p<x;p++)H=a[p],m=H[0],g=H[1],m+=0.5,g+=0.5,H=d*m+e*g-0.5|0,m=h*m+b*g-0.5|0,k.push([H,m]);return c?this.normalize(k):k},normalize:function(a){return this.Id(this.wb(a))},wb:function(a){var b,c;c=this.R(a);b=c[0];c=c[1];
b-=x(b,2);c-=x(c,2);return this.offset(a,-b,-c)},la:function(a){var b,c,d,e,m;m=[];d=0;for(e=a.length;d<e;d++)c=a[d],b=c[0],c=c[1],m.push([b+1,c+1]);return h.wb(m)},offset:function(a,b,c){var d,e,m;e=0;for(m=a.length;e<m;e++)d=a[e],d[0]+=b,d[1]+=c;return a},ib:function(a){a=this.R(a);return[a[2],a[3]]},find:function(a,b){var c,d,e,m,h,g,p;d=b[0];m=b[1];c=g=0;for(p=a.length;g<p;c=++g)if(h=a[c],e=h[0],h=h[1],e===d&&h===m)return c;return null},Y:function(a){var b,c,d,e,m,h,g,p,x,k,w;g="";c=0;b=function(a,
b){1<a&&(g+=a);g+=b};m=function(){0<c&&(b(c,"o"),c=0)};d=-1;h=k=p=0;for(w=a.length;k<w;h=++k){e=a[h];h=e[0];x=e[1];e=x-p;if(0>e)throw Error("Cell list are not sorted by Y");0<e&&(m(),b(e,"$"),d=-1,p=x);d=h-d;if(0>=d)throw Error("Cell list is not sorted by X");1===d?c++:1<d&&(m(),b(d-1,"b"),c=1);d=h}m();return g},Jc:function(a){var b;b=[];C(a,function(a,c){return b.push([a,c])});return b},Cc:function(a){var b,c,d,e,h,m,g,p,x,k;e=a.length;c=p=b=0;for(x=a.length;p<x;c=++p)for(m=a[c],h=m[0],m=m[1],d=
c=k=c+1;k<=e?c<e:c>e;d=k<=e?++c:--c)g=a[d],d=g[0],g=g[1],b+=1/Math.pow(Math.abs(h-d)+Math.abs(m-g),2);return b},dc:[[1,0,0,1],[0,1,-1,0],[-1,0,0,-1],[0,-1,1,0]],ac:function(a,b){var c,d,e,m,h,g;g=this.dc;m=0;for(h=g.length;m<h;m++)if(e=g[m],c=a*e[0]+b*e[1],d=a*e[2]+b*e[3],0<c&&0<=d)return[c,d,e];throw Error("Impossible to rotate vector ("+a+","+b+") to the positive direction");},Ya:function(d,e,m,h){var D,B,k,x,w,t,A,r,C,v,y,L;null==m&&(m=2048);null==h&&(h=!0);if(!d)throw Error("Pattern undefined");
if(!e)throw Error("Rule undefined");A=a.ae(e);if(null==A)throw Error("Empty field is not periodic for this rule. Analysis impossible");d=this.normalize(d);r=this.ib(d);x=r[0];k=r[1];t=64+2*Math.max(x+k,d.length);w=new p(new g(t,t),e);w.field.fill(0);r=w.i(c(t-x,2));v=w.i(c(t-k,2));w.field.Ha(d,r,v);D=new b(this.Cc);D.put(d);k=!1;for(x=L=1;L<=m;x=L+=1)if(w.transform(),0===x%A){if(h&&(w.field.sb(t,1)||w.field.sb(1,t)))break;B=w.field.za(0,0,t,t);y=this.R(B);C=y[0];y=y[1];C=w.i(C);y=w.i(y);this.offset(B,
-C,-y);if(this.ic(d,B)){k=!0;break}D.put(B)}d={ee:m};m=D.Kc();k&&(e=this.ab(m,e,C-r,y-v),m=e[0],d.n=e[1],d.A=e[2],d.M=x);d.cells=m;return d},ab:function(b,c,d,e){0===d&&0===e||!a.tb(c,k.rotate)||(c=this.ac(d,e),d=c[0],e=c[1],c=c[2],b=this.transform(b,c));return[b,d,e]},Mc:function(a,b,c,d){var e,g;g=m(b);e=g[0];g=g[1];if(null===e)return[null];a=h.la(h.transform(a,g));return h.ab(a,b,-(c*g[0]+d*g[1]),-(c*g[2]+d*g[3]))}};r.Wb={Dc:function(a,b){var c,d,e,m;c=a[0];e=a[1];d=b[0];m=b[1];return c===d&&e===
m},Mb:function(a,b){return[a[0]-b[0],a[1]-b[1]]},add:function(a,b){return[a[0]+b[0],a[1]+b[1]]},Ce:function(a){var b;b=a[0];a=a[1];return 0===b&&0===a},scale:function(a,b){return[a[0]*b,a[1]*b]},Qe:function(a,b){return[a[0]*b|0,a[1]*b|0]},je:function(a,b){var c,d,e,m;c=a[0];e=a[1];d=b[0];m=b[1];return[[Math.min(c,d),Math.min(e,m)],[Math.max(c,d),Math.max(e,m)]]},$a:function(a,b){var c,d,e,m;c=a[0];e=a[1];d=b[0];m=b[1];return[Math.min(c,d),Math.min(e,m),Math.max(c,d)+1,Math.max(e,m)+1]},Ye:function(a,
b){var c,d;c=b[0];d=b[1];a[0]=Math.min(a[0],c);a[1]=Math.min(a[1],d);a[2]=Math.max(a[2],c);a[3]=Math.max(a[3],d);return a}};r.ne=e=function(a,b,c,d){var e,m,h,g,p,x,k,w,t,A;null==d&&(d=null);if(0!==a[0])throw Error("Rule has instable vacuum and not supported.");g={};e=0;for(p=b.length;e<p;e++)h=b[e],m=h[0],w=h[1],t=h[2],m+=c,w+=c,h=m&1,k=w&1,k=h+2*k,m>>=1,h=w>>1,w=""+m+" "+h,m=null!=(x=g[w])?x:g[w]=[0,0,0,0,m,h],m[k]=t;t=[];for(w in g)h=g[w],b=h[0],e=h[1],p=h[2],x=h[3],m=h[4],h=h[5],m=(m<<1)-c,h=
(h<<1)-c,A=a[(0!==b)+((0!==e)<<1)+((0!==p)<<2)+((0!==x)<<3)],k=b||e||p||x,A&1&&t.push([m,h,k]),A&2&&t.push([m+1,h,k]),A&4&&t.push([m,h+1,k]),A&8&&t.push([m+1,h+1,k]),null!=d&&(b&&b!==k&&d(k,b),e&&e!==k&&d(k,e),p&&p!==k&&d(k,p),x&&x!==k&&d(k,x));return t};r.Nc=m=function(a){var b,c,d,e,m,h,g;m=[["iden",[1,0,0,1]],["rot90",[0,1,-1,0]],["rot180",[-1,0,0,-1]],["rot270",[0,-1,1,0]],["flipx",[-1,0,0,1]],["flipy",[1,0,0,-1]],["flipxy",[0,1,1,0]],["flipixy",[0,-1,-1,0]]];c=function(a,b){var c,d;for(c=d=0;15>=
d;c=++d)if(a[b[a[c]]]!==b[c])return!1;return!0};h=0;for(g=m.length;h<g;h++)if(b=m[h],d=b[0],e=b[1],b=t(e),c(a,b))return[d,e,b];return[null]};r.Xe=t=function(a){var b,c,d,e,m,g;b=[[-1,0],[0,0],[-1,-1],[0,-1]];c=h.transform(b,a,!1);g=function(a){return h.find(b,c[a])};d=function(){var a,b;b=[];for(e=a=0;3>=a;e=++a)b.push(g(e));return b}();m=function(a){var b,c;for(e=c=b=0;3>=c;e=++c)a>>e&1&&(b|=1<<d[e]);return b};return function(){var a,b;b=[];for(e=a=0;15>=a;e=++a)b.push(m(e));return b}()};r.me=function(a,
b,c){var d,e,m,h,g,k,p,x,w,t;if(0!==a[0])throw Error("Rule has instable vacuum and not supported.");m={};x=0;for(w=b.length;x<w;x++)d=b[x],g=d[0],k=d[1],g+=c,k+=c,d=g>>1,e=k>>1,h=""+d+" "+e,d=null!=(t=m[h])?t:m[h]=[0,d,e],d[0]|=1<<(g&1)+2*(k&1);b=[];for(p in m)e=m[p],g=e[0],d=e[1],e=e[2],d=(d<<1)-c,e=(e<<1)-c,g=a[g],g&1&&b.push([d,e]),g&2&&b.push([d+1,e]),g&4&&b.push([d,e+1]),g&8&&b.push([d+1,e+1]);return b};d=function(a,b){var c,d,e;d=0;for(e=b.length;d<e;d++)c=b[d],a.push(c)};r.Jd=function(a,b,
c){var m,h,g,k,x,p,w,t,A,r,C,v;x={};m={};p=[];g=C=0;for(v=b.length;C<v;g=++C)r=b[g],t=r[0],r=r[1],k=g+1,p.push([t,r,k]),x[k]=k,m[k]=[k];A=b.length;t=function(a,b){var c,e,h,l;c=x[a];h=x[b];if(c!==h){e=m[c];l=m[h];if(null==e||null==l)throw Error("assertion: group has no labels");d(e,l);delete m[h];e=0;for(h=l.length;e<h;e++)k=l[e],x[k]=c;A-=1}return null};for(g=C=0;C<=c&&!(p=e(a,p,g%2,t),1>=A);g=C+=1);return function(){var a;a=[];for(h in m)w=m[h],a.push(function(){var a,c,d;d=[];a=0;for(c=w.length;a<
c;a++)k=w[a],d.push(b[parseInt(k,10)-1]);return d}());return a}()}},{"./math_util":6,"./reversible_ca":8,"./rle":9,"./rules":10}],4:[function(v,y,r){r.Sb=function(){function g(g){null==g&&(g=null);this.m=this.root=null===g?document.createDocumentFragment():document.createElement(g);this.O={}}g.prototype.b=function(g){this.m.appendChild(g=document.createElement(g));this.m=g;return this};g.prototype.ja=function(g){this.O[g]=this.m;return this};g.prototype.end=function(){var g;this.m=g=this.m.parentNode;
if(null===g)throw Error("Too many end()'s");return this};g.prototype.text=function(g){this.m.appendChild(document.createTextNode(g));return this};g.prototype.H=function(g,h){this.m.setAttribute(g,h);return this};g.prototype.append=function(g){this.m.appendChild(g);return this};g.prototype.f=function(g){return this.H("class",g)};g.prototype.T=function(){var g;g=this.root;this.root=this.m=this.O=null;return g};return g}()},{}],5:[function(v,y,r){var g,k;g=v("./reversible_ca").pa;k=v("./math_util").ca;
r.Tb=function(){function h(h){this.field=h;this.va=["#888","#ff0"];this.e=4;this.o=1;this.C=null;this.K=["rgb(153,153,153)","gray"]}h.prototype.be=function(h,b){var a;a=this.e;return[k(h,a),k(b,a)]};h.prototype.zc=function(h,b,a,c,e){var d,m,g,k,A,r;d=this.e;m=this.o;if(!(d<=this.o))return g=d*c,A=d*e,k=d*b,r=d*a,e=function(a,b){var c,e,k,w;h.fillStyle=b;w=[];c=e=a;for(k=2*d;0<k?e<g:e>g;c=e+=k)w.push(h.fillRect(c,r,m,A-r));return w},c=function(a,b){var c,e,r,C;h.fillStyle=b;C=[];c=e=a;for(r=2*d;0<
r?e<A:e>A;c=e+=r)C.push(h.fillRect(k,c,g-k,m))},c(r+d-1,this.K[a%2]),e(k+d-1,this.K[b%2]),c(r+d+d-1,this.K[(a+1)%2]),e(k+d+d-1,this.K[(b+1)%2])};h.prototype.S=function(h,b,a,c,e){var d,m,g,k,r,C,t,l,n,u,v;t=this.e;l=this.o;d=this.field.data;r=this.Rc().data;C=255;for(m=u=a;u<e;m=u+=1)for(g=this.field.u(b,m),k=v=b;v<c;k=v+=1)n=d[g],r[g]!==n&&(n!==C&&(C=n,h.fillStyle=this.va[n]),h.fillRect(t*k,t*m,t,t),r[g]=n),g++;if(0<l)return this.zc(h,b,a,c,e)};h.prototype.w=function(h){return this.S(h,0,0,this.field.width,
this.field.height)};h.prototype.Rc=function(){var h;h=this.field;if(this.C&&this.C.width===h.width&&this.C.height===h.height)return this.C;h=new g(h.width,h.height);h.fill(255);return this.C=h};h.prototype.Aa=function(){this.C&&this.C.fill(255)};return h}()},{"./math_util":6,"./reversible_ca":8}],6:[function(v,y,r){var g,k,h,p,b;r.Oc=function(a){var b;for(b=-1;a/=1024,b++,1024<a;);return""+Math.max(a,0.1).toFixed(1)+" kB; MB; GB; TB;PB;EB;ZB;YB".split(";")[b]};r.sd=p=function(a,b){var e;if(0>b)return p(-a,
-b);if(0===a)return 0===b?"0/0":"0";if(0===b)return"1/0";e=g(Math.abs(a),b);return""+a/e+"/"+b/e};r.Ca=function(a,b){var e;e=a%b;return 0>e?e+b:e};r.ca=function(a,b){return a/b|0};r.Ee=k=function(a){return 0<a?1:0>a?-1:0};r.Ec=function(a,b,e){var d,h;for(d=h=0;0<=b?h<b:h>b;d=0<=b?++h:--h)a[d]=e;return a};b=function(a,b){var e,d,h;e=d=0;for(h=a.length;d<h;e=d+=1)a[e]*=b};r.dd=h=function(a,c){var e,d,m,g,w;e=k(a);d=k(c);if(0>e||0>d)return g=h(a*e,c*d),m=g[0],g=g[1],1!==e&&b(m,e),1!==d&&b(g,d),[m,g];
if(c>a)return g=h(c,a),m=g[0],g=g[1],[g,m];if(0===a)return[[0],[0]];m=[];g=[];e=c/a;for(d=w=0;0<=a?w<=a:w>=a;d=0<=a?++w:--w)m.push(d),g.push(Math.floor(d*e));return[m,g]};r.ve=g=function(a,b){return a<b?g(b,a):0===b?a:g(b,a%b)};r.kc=function(a,b,e){return Math.min(b,Math.max(a,e))};r.Ub=function(){function a(a){this.Rd=null!=a?a:M();this.ua=this.Za=null}a.prototype.put=function(a){var b;b=this.Rd(a);if(!this.pb()||b>this.ua)this.Za=a,this.ua=b;return this};a.prototype.pb=function(){return null!=this.ua};
a.prototype.Kc=function(){if(!this.pb())throw Error("Has no values");return this.Za};return a}()},{}],7:[function(v,y,r){var g;r.pd=g=function(k){var h,p,b;p=g.options;h=p.Fa[p.Od?"strict":"loose"].exec(k);b={};for(k=14;k--;)b[p.key[k]]=h[k]||"";b[p.Ia.name]={};b[p.key[12]].replace(p.Ia.Fa,function(a,c,e){if(c)return b[p.Ia.name][c]=e});return b};g.options={Od:!1,key:"source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),Ia:{name:"queryKey",
Fa:/(?:^|&)([^&=]*)=?([^&]*)/g},Fa:{Ue:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,Fe:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},{}],8:[function(v,y,r){var g,k,h;k=v("./math_util");v=v("./rules");h=k.Ca;g=v.qa;r.pa=function(){function g(b,a){this.width=
b;this.height=a;this.xb=this.width*this.height;var c;try{c=new Int8Array(this.xb)}catch(e){c=[]}this.data=c}g.prototype.fill=function(b){return k.Ec(this.data,this.xb,b)};g.prototype.u=function(b,a){return a*this.width+b};g.prototype.set=function(b,a,c){return this.data[this.u(b,a)]=c};g.prototype.Ed=function(b,a){return this.data[this.u(h(b,this.width),h(a,this.height))]=1};g.prototype.get=function(b,a){return this.data[this.u(b,a)]};g.prototype.size=function(){return[this.width,this.height]};g.prototype.Sc=
function(b,a){return this.data[this.u(h(b,this.width),h(a,this.height))]};g.prototype.rd=function(b,a,c,e,d){var g,h,k;g=this.data;for(h=a;a<e;h=a+=1)for(h=this.u(b,h),k=b;k<c;k+=1)g[h]=Math.random()<=d?1:0,h++};g.prototype.I=function(b,a,c,e,d){var h,g,k;h=this.data;for(g=a;a<e;g=a+=1)for(g=this.u(b,g),k=b;k<c;k+=1)h[g]=d,g++};g.prototype.Fc=function(b,a,c,e){var d,g;g=this.width;d=this.height;this.I(0,0,g,a);this.I(0,a,b,e);this.I(c,a,g,e);this.I(0,e,g,d)};g.prototype.sb=function(b,a){var c,e,d,
g;for(e=d=0;d<a;e=d+=1)for(c=g=0;g<b;c=g+=1)if(0!==this.get(c,e))return!0;return!1};g.prototype.za=function(b,a,c,e){var d,g,h,k,p;d=[];for(h=k=a;k<e;h=k+=1)for(g=p=b;p<c;g=p+=1)0!==this.Sc(g,h)&&d.push([g-b,h-a]);return d};g.prototype.Ha=function(b,a,c,e){var d,g,k,p,r,v;null==e&&(e=1);g=this.width;d=this.height;r=0;for(v=b.length;r<v;r++)p=b[r],k=p[0],p=p[1],this.set(h(a+k,g),h(c+p,d),e);return null};g.prototype.qd=function(b,a,c,e){var d,g=!0,k,p,r,v,t,l,n,u,z;null==g&&(g=!1);null==d&&(d=4);l=
this;z=this.width;r=this.height;u={};k=[];t=function(a,b){return""+a+"#"+b};v=function(a,b){return u.hasOwnProperty(t(a,b))};n=function(a,b){u[t(a,b)]=!0};p=function(a,b){var t,u,y,G,K;t=h(a,z);u=h(b,r);if(!v(t,u)&&0!==l.get(t,u)){n(t,u);k.push([a-c,b-e]);g&&l.set(t,u,0);for(u=G=-d;G<=d;u=G+=1)for(y=b+u,t=K=-d;K<=d;t=K+=1)0===u&&0===t||p(a+t,y);return k}};return p(b,a)};return g}();r.Sa=function(){function k(b,a){this.field=b;if(0!==b.width%2||0!==b.height%2)throw"Field size must be even, not "+b.width+
"x"+b.height;this.l=this.J=0;this.D(a)}k.prototype.D=function(b){this.d=b;return this.qb=null};k.prototype.Pb=function(b,a,c){null!=c.call?this.Vd(b,a,c):this.Ud(b,a,c)};k.prototype.Ud=function(b,a,c){var e,d,g,h,k,r,p,t,l,n,u;t=this.field;p=t.data;l=t.width;t=t.height;for(g=n=a;n<t;g=n+=2)for(a=g+1<t?l:l*(1-t),g=g*l+b,e=u=b;u<l;e=u+=2)e=e+1<l?1:1-l,h=g+e,k=g+a,r=h+a,e=p[g]|p[h]<<1|p[k]<<2|p[r]<<3,d=c[e],d!==e&&(p[g]=d&1,p[h]=d>>1&1,p[k]=d>>2&1,p[r]=d>>3&1),g+=2};k.prototype.Vd=function(b,a,c){var e,
d,g,h,k,p,r,t,l;p=this.field;k=p.data;r=p.width;p=p.height;for(e=t=a;t<p;e=t+=2)for(a=e+1<p?r:r*(1-p),e=e*r+b,d=l=b;l<r;d=l+=2)d=d+1<r?1:1-r,d=e+d,g=e+a,h=d+a,c(k,e,d,g,h),e+=2};k.prototype.transform=function(){var b;b=this.l;this.Pb(b,b,this.d);this.l=h(this.l+1,2);return this.J++};k.prototype.Xd=function(){var b;b=h(this.l-1,2);this.Pb(b,b,this.Qc());this.l=h(this.l-1,2);this.J--};k.prototype.Qc=function(){var b;if(null==(b=this.qb)){if(null!=this.d.call){if(null==this.d.inverse)throw"Inverse rule not provided!";
b=this.d.inverse}else b=g.reverse(this.d);b=this.qb=b}return b};k.prototype.clear=function(){this.Hb(0);return this.field.fill(0)};k.prototype.Hb=function(b){this.l=h(b,2);this.J=b};k.prototype.i=function(b){return b-h(b+this.l,2)};k.prototype.Kb=function(b){return b+h(b+this.l,2)};k.prototype.Hd=function(b){var a,c,e;a=b[0];e=b[1];c=b[2];b=b[3];return[this.i(a),this.i(e),this.Kb(c),this.Kb(b)]};return k}()},{"./math_util":6,"./rules":10}],9:[function(v,y,r){(function(){function g(){this.stack=[];
this.v=null}g.prototype.Pc=function(){var g;g=this.v;return null==g?null:g[0]};g.prototype.put=function(g){var h;if("b"!==g&&"o"!==g&&"$"!==g)throw"Character "+g+" is wrong";h=this.Pc();if(g===h)return this.v[1]+=1;if("$"===g&&"b"===h)return this.pop(),this.put(g);this.v=[g,1];return this.stack.push(this.v)};g.prototype.pop=function(){var g;g=this.stack;g.pop();return 0===g.length?this.v=null:this.v=g[g.length-1]};return g})();r.Bb=function(g,k){var h,p,b,a,c,e,d,m;a=d=b=e=c=0;for(m=g.length;0<=m?
d<m:d>m;a=0<=m?++d:--d)if(h=g.charAt(a),"0"<=h&&"9">=h)b=10*b+parseInt(h,10);else switch(p=Math.max(b,1),b=0,h){case "b":c+=p;break;case "$":e+=p;c=0;break;case "o":for(h=0;h<p;h+=1)k(c,e),c+=1;break;default:throw Error("Unexpected character '"+h+"' at position "+a);}return null};r.td=function(g){return g.replace(/\s+/g,"")}},{}],10:[function(v,y,r){var g,k,h,p;p=function(b,a){var c;if(b.length!==a.length)throw Error("Transpositions are incompatible");var e,d,g;g=[];e=0;for(d=b.length;e<d;e++)c=b[e],
g.push(a[c]);return g};r.qa=h={ea:"undefined"!==typeof Int8Array&&null!==Int8Array?function(b){return new Int8Array(b)}:M(),Td:"undefined"!==typeof Int8Array&&null!==Int8Array?function(b){var a,c,e,d;d=[];c=0;for(e=b.length;c<e;c++)a=b[c],d.push(a);return d}:M(),parse:function(b,a){var c,e,d,g,k,p;null==a&&(a=",");e=b.split(a);c=e.length;if(16!==c)throw Error("Invalid rule string ["+b+"], rule must have 16 parts, but have "+c);g=[];c=k=0;for(p=e.length;k<p;c=++k)if(d=e[c],g.push(d=parseInt(d,10)),
!(0<=d&&16>d))throw"Invalid value ["+d+"] at position "+c+" in rule; must have values in range 0..15";return h.ea(g)},stringify:function(b){return h.Td(b).join(",")},ke:function(b,a){var c,e,d,g;c=d=0;for(g=b.length;d<g;c=++d)if(e=b[c],e!==a[c])return!1;return!0},reverse:function(b){var a,c;if(!h.rb(b))throw Error("Rule is not invertible");var e;e=[];for(a=0;15>=a;++a)e.push(null);for(a=c=0;15>=c;a=++c)e[b[a]]=a;return h.ea(e)},rb:function(b){var a,c,e,d,g,k,p,r,v,t;c=function(){var a,c,d;d=[];a=
0;for(c=b.length;a<c;a++)g=b[a],d.push(g);return d}();c.sort(function(a,b){return a-b});d=k=0;for(p=c.length;k<p;d=++k)if(g=c[d],g!==d)return!1;!0;({Ge:P()});c=function(a,b,c){var e,g,h;g=function(){var a,b;b=[];for(d=a=0;15>=a;d=++a)b.push(null);return b}();h=[];e=function(a,b){var d,k,l;if(null!=(d=g[a])){if(d!==b)throw Error("Samples are contradicting invariants");}else for(g[a]=b,h.push([a,b]),k=0,l=c.length;k<l;k++)d=c[k],e(d(a),d(b))};e(a,b);return h};b=function(){var a,b;b=[];for(d=a=0;15>=
a;d=++a)b.push(null);return b}();d=k=0;for(r=samples.length;k<r;d=++k)for(t=c(a,e,invariants),e=p=0,v=t.length;p<v;e=++p){a=t[e];if(null!==b[a]&&b[a]!==e)throw Error("Sample "+(d+1)+" conflicts with other samples");b[a]=e}d=a=0;for(e=b.length;a<e;d=++a)if(g=b[d],null===g)throw Error("Samples incomplete. State "+d+" has no descendant");return h.ea(b)},ub:function(b){var a,c,e,d,k,p,r,v;v=[];for(e=0;15>=e;++e)v.push(null);e=k=0;for(r=b.length;k<r;e=++k)for(c=b[e],a=c[0],c=c[1],d=p=0;3>=p;d=++p){if(null!==
v[a]&&v[a]!==c)throw Error("Sample #"+(e+1)+" (rotated by"+d+") conflicts");v[a]=c;a=g.rotate(a);c=g.rotate(c)}e=a=0;for(k=v.length;a<k;e=++a)if(b=v[e],null===b)throw Error("Samples incomplete. State "+e+" has no descendant");return h.ea(v)},tb:function(b,a){var c,e,d;for(c=d=0;16>d;c=++d)if(e=b[a(c)],c=a(b[c]),e!==c)return!1;return!0},Gc:function(b){var a,c,e,d,k,p;d=[["rot90",g.rotate],["rot180",g.Eb],["flipx",g.jb],["flipy",g.kb],["negate",g.ga],["flipy_neg",function(a){return g.ga(g.kb(a))}],
["flipx_neg",function(a){return g.ga(g.jb(a))}]];c={};k=0;for(p=d.length;k<p;k++)e=d[k],a=e[0],e=e[1],h.tb(b,e)&&(c[a]=!0);return c},$c:function(b){var a,c,e,d,h;a=c=!0;for(d=h=0;16>h&&(e=g.Nb(d),d=g.Nb(b[d]),e!==d&&(c=!1),e!==4-d&&(a=!1),c||a);d=++h);return c?"const":a?"inv-const":"none"},ae:function(b){var a,c,e,d;a=g.Eb;e=0;for(c=d=1;16>=d;c=++d)if(0===(e=a(b[e])))return c;return null},oe:function(b){var a;if(!h.bd(b))throw Error("Rule is not flashing");a=g.Qd(g.Be);return[p(b,a),p(a,b)]},bd:function(b){return 15===
b[0]},De:function(b){return 0===b[0]}};r.Qb=g={rotate:function(b){b=g.get(b);return g.da(b[1],b[3],b[0],b[2])},get:function(b){var a,c,e;e=[];for(a=c=0;3>=c;a=++c)e.push(b>>a&1);return e},da:function(b,a,c,e){return b|a<<1|c<<2|e<<3},Eb:function(b){b=g.get(b);return g.da(b[3],b[2],b[1],b[0])},jb:function(b){b=g.get(b);return g.da(b[1],b[0],b[3],b[2])},kb:function(b){b=g.get(b);return g.da(b[2],b[3],b[0],b[1])},ga:function(b){return 15-b},Nb:function(b){b=g.get(b);return b[0]+b[1]+b[2]+b[3]},Qd:function(b){var a,
c,e;e=[];for(a=c=0;15>=c;a=++c)e.push(b(a));return e}};r.Vb=k={Wd:h.parse("15,1,2,3,4,5,6,7,8,9,10,11,12,13,14,0",","),fe:h.parse("0,8,4,3,2,5,9,7,1,6,10,11,12,13,14,15"),ge:h.parse("0,8,4,3,2,5,9,14, 1,6,10,13,12,11,7,15"),ze:h.parse("0,8,4,12,2,10,9, 14,1,6,5,13,3,11,7,15"),Le:h.parse("0,2,8,12,1,10,9, 11,4,6,5,14,3,7,13,15"),Me:h.parse("0,2,8,12,1,10,9, 13,4,6,5,7,3,14,11,15"),Ne:h.parse("0,4,1,10,8,3,9,11, 2,6,12,14,5,7,13,15"),Oe:h.parse("0,4,1,12,8,10,6,14, 2,9,5,13,3,11,7,15"),Pe:h.parse("0,4,8,12,4,12,12,13, 8,12,12,14,12,13,14,15"),
Pd:h.parse("0,1,2,12,4,10,9,7,8, 6,5,11,3,13,14,15",","),Ve:h.parse("0,1,2,12,4,10,6,7,8, 9,5,11,3,13,14,15"),We:h.parse("0,8,4,12,2,10,6,14, 1,9,5,13,3,11,7,15"),rc:h.ub([[0,15],[15,0],[1,14],[14,8],[3,3],[6,6]]),yc:h.parse("0, 2, 8, 3, 1, 5, 6, 13, 4, 9, 10, 7, 12, 14, 11, 15"),Gd:h.ub([[0,0],[1,2],[3,3],[6,6],[7,7],[15,15]])};r.Xb=function(){var b,a,c;a={};for(b in k)c=k[b],a[h.stringify(c)]=b;return a}()},{}]},{},[1]);
